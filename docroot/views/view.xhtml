<?xml version="1.0"?>

<f:view contentType="text/html"
	xmlns="http://www.w3.org/1999/xhtml"
	xmlns:c="http://java.sun.com/jsp/jstl/core"
	xmlns:f="http://java.sun.com/jsf/core"
	xmlns:h="http://java.sun.com/jsf/html"
	xmlns:p="http://primefaces.org/ui"
	xmlns:ui="http://java.sun.com/jsf/facelets">
	<h:head />
	<h:body>

	<h:panelGroup id="mainGroup" layout="block" styleClass="backgroundofContent">
		<h:form id="formAnalyze">
		
			<h:panelGroup rendered="#{analyzeBacking.user != null}">
				
				<p:remoteCommand name="treeToTable" actionListener="#{analyzeBacking.treeToTable}" update="availableStudy" oncomplete="initDragDrop()"/>
				
				<p:layout id="layoutAnalyze" style="width:100%;height:600px" >
			
					<p:layoutUnit styleClass="westpanel" position="west" header="Drag and drop folders or files to be Analyzed" resizable="true" size="385" minSize="385" maxSize="600" collapsible="true" >
	
						<h:panelGroup layout="block" id="analyzeTreeHolder"	style="height:100%;overflow:auto">
							<p:tree id="docTree" 
								dynamic="true"
								selection="#{analyzeBacking.fileTree.selectedNode}"
								selectionMode="single"
								value="#{analyzeBacking.fileTree.treeRoot}" 
								var="node"
								animate="true"
								style="width:100%">
								
								<p:ajax event="expand" oncomplete="initDragDrop()" />  
								
								<p:treeNode expandedIcon="ui-icon-folder-open" collapsedIcon="ui-icon-folder-collapsed">
									<h:outputText value="#{node}" />
								</p:treeNode>
								
								<p:treeNode type="document" icon="ui-icon ui-icon-note">
									<h:outputText value="#{node}"/>
								</p:treeNode>
								
								<p:treeNode type="analysis" icon="ui-icon ui-icon-document">
									<h:outputText value="#{node}"/>
								</p:treeNode>
								
								<p:treeNode type="document_error" icon="ui-icon ui-icon-alert">
									<h:outputText value="#{node}"/>
								</p:treeNode>
								
							</p:tree>
							
							<h:panelGroup layout="block">
								<h:panelGroup styleClass="ui-layout-unit-header ui-widget-header ui-corner-all">Analyze Instructions</h:panelGroup>
								<OL>
									<LI>Drag files or folders to the right.</LI>
									<LI>Select algorithms from the list below</LI>
									<LI>Click the "Start Analysis" button under the list on top right.</LI>
								</OL>
							</h:panelGroup>
							
						</h:panelGroup>
					</p:layoutUnit>
				
					<p:layoutUnit position="center" header="Files to be Analyzed" >
						
						<p:progressBar id="progressBarClient" widgetVar="pbClient" style="width:99%" styleClass="animated" labelTemplate="{value}%"/>
						
						<p:messages id="messages_prime" showSummary="true" showDetail="true" autoUpdate="true" closable="true" escape="false" />
						
						<p:remoteCommand name="updateProgressBar" action="#{analyzeBacking.updateProgressBar}" />
			    		<p:remoteCommand name="onComplete" action="#{analyzeBacking.onComplete}" update="availableStudy, availableAlgorithmTable"/>
			    	
							
						<p:dataTable id="availableStudy"
							var="studyHolder"
							rowIndexVar="index"
							styleClass="analyzeDataTable"
							sortMode="multiple"
							value="#{analyzeBacking.tableList}"
							resizableColumns="true"
							paginatorPosition="top"
							style="width:100%"
							emptyMessage="No records. Drop yours files here!">
		
							<p:column headerText="Subject ID" width="40%">
								<h:outputText value="#{studyHolder.fileNode.data}" />
							</p:column>
		
							<p:column headerText="File Format" width="15%">
								<h:outputText value="#{studyHolder.documentRecord.originalFormat.label}" />
							</p:column>
		
							<p:column headerText="File Date" width="35%">
								<h:outputText value="#{studyHolder.fileNode.content.createDate}" />
							</p:column>
							<p:column headerText="Remove" width="10%">
								<p:commandLink styleClass="ui-icon ui-icon-close dataTableCentered" update="availableStudy" actionListener="#{analyzeBacking.removeTableItem}" oncomplete="initDragDrop()">
									<f:param name="index" value="#{index}"/>
								</p:commandLink>
							</p:column>
						</p:dataTable>
						
						<div style="text-align: center;" class="ui-widget-header ui-corner-all">
							<p:commandButton value="Start Analysis" 
								icon="ui-icon-play"
								action="#{analyzeBacking.startAnalysis}"
								onclick="cancel();start()"/>
						</div>
						
							
					</p:layoutUnit>
					
					<p:layoutUnit position="south" size="300" header="Available Algorithms" resizable="true" collapsible="true">
						<p:dataTable id="availableAlgorithmTable"
							var="algorithm"
							value="#{analyzeBacking.algorithmList.availableAlgorithms}"
							rowKey="#{algorithm.shortName}"
							selection="#{analyzeBacking.selectedAlgorithms}">
							
							<p:ajax event="rowSelectCheckbox" listener="#{analyzeBacking.onRowSelect}" update="availableAlgorithmTable"/>  
			      			<p:ajax event="rowUnselectCheckbox" listener="#{analyzeBacking.onRowUnselect}" update="availableAlgorithmTable"/>  
									
							<p:column selectionMode="multiple" style="width:2%"/>
							
							<p:column headerText="Name" style="width:25%">  
			          				<h:outputLabel value="#{algorithm.shortName}"/> 
			      				</p:column> 
								
							<p:column headerText="Description" style="width:73%">  
			          				<h:outputLabel value="#{algorithm.longDescription}"/>  
			      				</p:column> 	
						</p:dataTable>
					</p:layoutUnit>
				</p:layout>
				<script type="text/javascript">
					initDragDrop();
				</script>
			</h:panelGroup>
			
			<h:panelGroup rendered="#{analyzeBacking.user == null}">
				<div class="signin">
					Please <a href="/c/portal/login" rel="nofollow">Sign In</a>
				</div>
			</h:panelGroup>
			
		</h:form>
	</h:panelGroup>

	</h:body>
</f:view>
